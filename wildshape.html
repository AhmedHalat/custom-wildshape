<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Wild Shape Point Selector</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 20px;
			padding: 0;
			line-height: 1.6;
			background: #ff9292;
		}
		.container {
			max-width: 600px;
			margin: 0 auto;
			padding: 20px;
			border: 1px solid #ccc;
			border-radius: 10px;
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
			background: #fff;
		}
		h1 {
			text-align: center;
		}
		h3 {
			margin-bottom: 5px;
		}
		h4 {
			margin-top: 10px;
			margin-bottom: 5px;
		}
		.form-group {
			margin-bottom: 15px;
		}
		label {
			font-weight: bold;
		}
		.attribute, .stat {
			margin-bottom: 10px;
		}
		.attribute input, .stat input {
			margin-right: 10px;
		}
		#remaining-points, #remaining-stat-points {
			font-weight: bold;
			color: green;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>Wild Shape Points Selector</h1>
		<div class="form-group">
			<label for="level">Enter Your Level:</label>
			<input type="number" id="level" min="1" value="1">
		</div>

		<div id="templates">
			<h3>Templates:</h3>
			<select id="template-selector">
				<option value="template1">Template 1</option>
				<option value="template2">Template 2</option>
				<option value="template3">Template 3</option>
				<option value="template4">Template 4</option>
			</select>
		</div>

		<div class="form-group">
			<p>Remaining Points: <span id="remaining-points">3</span></p>
		</div>

		<div id="modifiers">
			<h3>Modifiers:</h3>
			<div class="form-group">
				<label for="hit-dice">HP/Hit Dice:</label>
				<input type="number" id="hit-dice" min="4" max="12" value="4" class="hit-dice modifier" step="2">
			</div>
			<div class="form-group">
				<label for="damage-dice">Damage Dice:</label>
				<input type="number" id="damage-dice" min="4" max="12" value="4" class="damage-dice modifier" step="2">
			</div>
			<div class="form-group">
				<label for="speed">Speed (ft):</label>
				<input type="number" id="speed" min="20" max="50" value="20" class="speed modifier" step="10">
			</div>
		</div>

		<div id="attributes">
			<h3>Select Attributes:</h3>
			<div class="attribute-category">
				<h4>Movement</h4>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="3"> <label>Fly (8) - 3 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Burrow - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Swim (4) - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Climb - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="3"> <label>SpiderClimb - 3 WP</label></div>
			</div>
			<div class="attribute-category">
				<h4>Vision</h4>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="1"> <label>Darkvision - 1 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Tremor Sense - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="3"> <label>Blindsight - 3 WP</label></div>
			</div>
			<div class="attribute-category">
				<h4>Combat</h4>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="5"> <label>Multiattack (5) - 5 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="1"> <label>Pack Tactics - 1 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Ranged Attack - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Trample - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="3"> <label>Rampage (3) - 3 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="1"> <label>Ink Cloud - 1 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="3"> <label>Constrict - 3 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Flyby - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="3"> <label>Shield - 3 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="1"> <label>Mommy Poulet - 1 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="1"> <label>Daddy Beef - 1 WP</label></div>
			</div>
			<div class="attribute-category">
				<h4>Perception</h4>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Keen Smell - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Keen Hearing - 2 WP</label></div>
				<div class="attribute"><input type="checkbox" class="attribute-checkbox" data-cost="2"> <label>Keen Sight - 2 WP</label></div>
			</div>
		</div>
		<style>
			.attribute-category {
				display: flex;
				flex-wrap: wrap;
				gap: 10px;
			}
			.attribute-category h4 {
				flex: 1 1 100%;
			}
			.attribute {
				flex: 1 1 calc(50% - 10px);
				display: flex;
				align-items: center;
			}
		</style>

		<div id="stats">
			<h3>Assign Stat Points:</h3>
			<p>Remaining Stat Points: <span id="remaining-stat-points">30</span></p>
			<div class="stat" data-stat="Strength">
				<label>Strength:</label>
				<input type="number" class="stat-input" min="10" value="10">
			</div>
			<div class="stat" data-stat="Dexterity">
				<label>Dexterity:</label>
				<input type="number" class="stat-input" min="10" value="10">
			</div>
			<div class="stat" data-stat="Constitution">
				<label>Constitution:</label>
				<input type="number" class="stat-input" min="10" value="10">
			</div>
			<!-- <div class="stat" data-stat="Intelligence">
				<label>Intelligence:</label>
				<input type="number" class="stat-input" min="10" value="10">
			</div>
			<div class="stat" data-stat="Wisdom">
				<label>Wisdom:</label>
				<input type="number" class="stat-input" min="10" value="10">
			</div>
			<div class="stat" data-stat="Charisma">
				<label>Charisma:</label>
				<input type="number" class="stat-input" min="10" value="10">
			</div> -->
		</div>
	</div>

	<script>
		const levelInput = document.getElementById('level');
		if (localStorage.getItem('level')) {
			levelInput.value = localStorage.getItem('level');
		}

		const remainingPointsSpan = document.getElementById('remaining-points');
		const attributeCheckboxes = document.querySelectorAll('.attribute-checkbox');
		const statInputs = document.querySelectorAll('.stat-input');
		const modifiers = document.querySelectorAll('.modifier');
		const speedInput = document.getElementById('speed');
		const remainingStatPointsSpan = document.getElementById('remaining-stat-points');

		const templateSelector = document.getElementById('template-selector');
		let previousTemplate = templateSelector.value;

		function saveTemplate(name) {
			const templateName = name || templateSelector.value;

			console.log('Saving template:', templateName);
			if (!templateName) return;

			const template = {}
			const attributes = {};
			const stats = {};
			const modifierStats = {};
			attributeCheckboxes.forEach(checkbox => {
				attributes[checkbox.nextElementSibling.textContent.trim()] = checkbox.checked;
			});

			statInputs.forEach(input => {
				stats[input.previousElementSibling.textContent.trim()] = parseInt(input.value);
			});

			modifiers.forEach(modifier => {
				modifierStats[modifier.id] = parseInt(modifier.value);
			});

			modifierStats['speed'] = parseInt(speedInput.value);

			template.attributes = attributes;
			template.stats = stats;
			template.modifiers = modifierStats;

			localStorage.setItem(templateName, JSON.stringify(template));
		}

		function loadTemplate() {
			if (previousTemplate) saveTemplate(previousTemplate);
			const templateName = templateSelector.value;
			if (!templateName) return;

			let template = JSON.parse(localStorage.getItem(templateName));
			if (!template) {
				template = { attributes: {}, stats: {}, modifiers: {} };
			}

			attributeCheckboxes.forEach(checkbox => {
				const label = checkbox.nextElementSibling.textContent.trim();
				checkbox.checked = template.attributes[label];
			});

			statInputs.forEach(input => {
				const label = input.previousElementSibling.textContent.trim();
				input.value = template.stats[label];
			});

			modifiers.forEach(modifier => {
				let base = modifier.id.includes('dice') ? 4 : 20;

				modifier.value = template.modifiers[modifier.id] || base;
			});

			speedInput.value = template.modifiers['speed'] || 20;

			updatePoints();
			updateStatPoints();
			previousTemplate = templateName;
		}

		function isAttributeSelectedInOtherTemplates(attributeLabel) {
			const currentTemplate = templateSelector.value;
			for (let i = 0; i < templateSelector.options.length; i++) {
				const templateName = templateSelector.options[i].value;
				if (templateName !== currentTemplate) {
					const template = JSON.parse(localStorage.getItem(templateName));
					if (template && template.attributes && template.attributes[attributeLabel]) {
						return true;
					}
				}
			}
			return false;
		}

		const statPointsByLevel = {
			1: 30, 2: 32, 3: 34, 4: 36, 5: 38, 6: 40, 7: 42, 8: 44, 9: 46, 10: 48,
			11: 50, 12: 52, 13: 54, 14: 56, 15: 58, 16: 60, 17: 62, 18: 64, 19: 66, 20: 68
		};

		function updatePoints() {
			// save level
			const level = parseInt(levelInput.value) || 1;
			localStorage.setItem('level', levelInput.value);
			saveTemplate();
			const totalPoints = level * 3;
			let usedPoints = 0;

			attributeCheckboxes.forEach(checkbox => {
				const label = checkbox.nextElementSibling.textContent.trim();
				if (isAttributeSelectedInOtherTemplates(label)) {
					checkbox.disabled = true;
					checkbox.checked = false;
				} else {
					checkbox.disabled = false;
				}
			});

			let remainingPoints = totalPoints - usedPoints;

			// Update stat points based on level
			remainingStatPointsSpan.textContent = statPointsByLevel[level] || 30;

			// Update remaining points across all templates
			for (let i = 0; i < templateSelector.options.length; i++) {
				const templateName = templateSelector.options[i].value;
				const template = JSON.parse(localStorage.getItem(templateName));
				if (template) {
					let templateUsedPoints = 0;
					for (const attribute in template.attributes) {
						if (template.attributes[attribute]) {
							const checkbox = Array.from(attributeCheckboxes).find(cb => cb.nextElementSibling.textContent.trim() === attribute);
							if (checkbox) {
								templateUsedPoints += parseInt(checkbox.dataset.cost);
							}
						}
					}
					for (const modifier in template.modifiers) {
						const modifierValue = template.modifiers[modifier];
						if (modifier.includes('hit-dice') || modifier.includes('damage-dice')) {
							templateUsedPoints += getDiceCost(modifierValue);
						} else if (modifier.includes('speed')) {
							templateUsedPoints += getSpeedCost(modifierValue);
						} else {
							templateUsedPoints += modifierValue;
						}
					}
					remainingPoints -= templateUsedPoints;
				}
			}
			remainingPointsSpan.textContent = remainingPoints;
			remainingPointsSpan.style.color = remainingPoints < 0 ? 'red' : 'green';
		}

		function updateStatPoints() {
			let usedStatPoints = 0;
			statInputs.forEach(input => {
				let statValue = parseInt(input.value) || 10;
				let cost = statValue - 10;
				if (statValue > 13) cost += (statValue - 13);
				if (statValue > 17) cost += (statValue - 17);
				usedStatPoints += cost;
			});

			const level = parseInt(levelInput.value) || 1;
			const totalStatPoints = statPointsByLevel[level] || 30;
			const remainingStatPoints = totalStatPoints - usedStatPoints;
			remainingStatPointsSpan.textContent = remainingStatPoints;
			remainingStatPointsSpan.style.color = remainingStatPoints < 0 ? 'red' : 'green';
		}

		function rollDice(s, n = 1) {
			const results = [];
			for (let i = 0; i < n; i++) {
				results.push(Math.floor(Math.random() * s) + 1);
			}
			return results;
		}

		function getDiceCost(diceValue) {
			let cost = 0;
			if (diceValue > 4) cost += 1;
			if (diceValue > 6) cost += 2;
			if (diceValue > 8) cost += 3;
			if (diceValue > 10) cost += 4;
			if (diceValue > 12) cost += 5;
			return cost;
		}

		function getSpeedCost(speedValue) {
			let cost = 0;
			if (speedValue > 20) cost += 1;
			if (speedValue > 30) cost += 2;
			if (speedValue > 40) cost += 3;
			if (speedValue > 50) cost += 4;

			return cost;
		}

		function updateDicePoints() {
			const hitDiceInput = document.getElementById('hit-dice');
			const damageDiceInput = document.getElementById('damage-dice');
			const speedInput = document.getElementById('speed');
			const diceInputs = [hitDiceInput, damageDiceInput];

			let usedDicePoints = 0;

			diceInputs.forEach(input => {
				let diceValue = parseInt(input.value) || 4;
				usedDicePoints += getDiceCost(diceValue);
			});

			const level = parseInt(levelInput.value) || 1;
			const totalPoints = level * 3;
			let usedPoints = 0;

			attributeCheckboxes.forEach(checkbox => {
				if (checkbox.checked) {
					usedPoints += parseInt(checkbox.dataset.cost);
				}
			});

			usedPoints += getSpeedCost(parseInt(speedInput.value));

			let remainingPoints = totalPoints - usedPoints - usedDicePoints;
			remainingPointsSpan.textContent = remainingPoints;
			remainingPointsSpan.style.color = remainingPoints < 0 ? 'red' : 'green';

			// Update remaining points across all templates
			saveTemplate();
			updatePoints();
		}

		const diceInputs = document.querySelectorAll('#hit-dice, #damage-dice, #speed');
		diceInputs.forEach(input => input.addEventListener('input', updateDicePoints));

		levelInput.addEventListener('input', updatePoints);
		attributeCheckboxes.forEach(checkbox => checkbox.addEventListener('change', updatePoints));
		statInputs.forEach(input => input.addEventListener('input', updateStatPoints));

		templateSelector.addEventListener('change', loadTemplate);

		// Initial load
		loadTemplate();
	</script>
</body>
</html>
